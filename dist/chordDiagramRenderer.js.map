{"version":3,"sources":["../src/chordDiagramRenderer.js"],"names":["renderChordDiagram","container","chordDiagramDivId","w","h","data","drawChords","matrix","mmap","r1","r0","console","log","fill","d3","scale","category10","chord","layout","padding","sortSubgroups","descending","sortChords","arc","svg","innerRadius","outerRadius","select","append","attr","rdr","chordRdr","g","selectAll","groups","enter","on","mouseover","d","style","gname","each","angle","startAngle","endAngle","Math","PI","text","chordPaths","chords","rgb","sname","darker","radius","html","chordTip","event","pageY","pageX","p","format","q","tname","svalue","stotal","mtotal","tvalue","ttotal","groupTip","gvalue","i","classed","source","index","target","build","mpr","chordMpr","addValuesToMap","setFilter","row","a","b","leavingPage","name","enteringPage","setAccessor","recs","count","getMatrix","getMap","_"],"mappings":"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","file":"chordDiagramRenderer.js","sourcesContent":["import _ from 'lodash';\nimport * as d3 from './external/d3.v3.min';\nimport chordMpr from './chordDataMapper';\nimport chordRdr from './chordDataReader';\n\nexport default function renderChordDiagram(container, chordDiagramDivId, w, h) {\n\n  var data = [\n    { \"leavingPage\": \"Deal\", \"enteringPage\": \"Facility\", \"count\": \"468\" },\n    { \"leavingPage\": \"Deal\", \"enteringPage\": \"Security Package\", \"count\": \"163\" },\n    { \"leavingPage\": \"Deal\", \"enteringPage\": \"Borrowing Base\", \"count\": \"34\" },\n    { \"leavingPage\": \"Facility\", \"enteringPage\": \"Deal\", \"count\": \"342\" },\n    { \"leavingPage\": \"Facility\", \"enteringPage\": \"Security Package\", \"count\": \"120\" },\n    { \"leavingPage\": \"Facility\", \"enteringPage\": \"Borrowing Base\", \"count\": \"13\" },\n    { \"leavingPage\": \"Security Package\", \"enteringPage\": \"Deal\", \"count\": \"154\" },\n    { \"leavingPage\": \"Security Package\", \"enteringPage\": \"Facility\", \"count\": \"24\" },\n    { \"leavingPage\": \"Security Package\", \"enteringPage\": \"Borrowing Base\", \"count\": \"4\" },\n    { \"leavingPage\": \"Borrowing Base\", \"enteringPage\": \"Deal\", \"count\": \"54\" },\n    { \"leavingPage\": \"Borrowing Base\", \"enteringPage\": \"Facility\", \"count\": \"9\" },\n    { \"leavingPage\": \"Borrowing Base\", \"enteringPage\": \"Borrowing Base\", \"count\": \"0\" },\n  ];\n\n  function drawChords(matrix, mmap) {\n    var r1 = h / 2, r0 = r1 - 110;\n    console.log(\"width: \" + w + \" height: \" + h + \" chordDiagramDivId: \" + chordDiagramDivId);\n\n    var fill = d3.scale.category10();\n\n    var chord = d3.layout.chord()\n      .padding(0.02)\n      .sortSubgroups(d3.descending)\n      .sortChords(d3.descending);\n\n    var arc = d3.svg.arc()\n      .innerRadius(r0)\n      .outerRadius(r0 + 20);\n\n    var svg = d3.select(container).append(\"svg:svg\")\n      .attr(\"width\", w)\n      .attr(\"height\", h)\n      .append(\"svg:g\")\n      .attr(\"id\", \"circle\")\n      .attr(\"transform\", \"translate(\" + w / 2 + \",\" + h / 2 + \")\");\n\n    svg.append(\"circle\")\n      .attr(\"r\", r0 + 20);\n\n    var rdr = chordRdr(matrix, mmap);\n    chord.matrix(matrix);\n\n    var g = svg.selectAll(\"g.group\")\n      .data(chord.groups())\n      .enter().append(\"svg:g\")\n      .attr(\"class\", \"group\")\n      .on(\"mouseover\", mouseover)\n      .on(\"mouseout\", function (d) {\n        d3.select(\".grafana-d3-chord-diagram-tooltip\").style(\"visibility\", \"hidden\");\n      });\n\n    g.append(\"svg:path\")\n      .style(\"stroke\", \"black\")\n      .style(\"fill\", function (d) {\n        return fill(rdr(d).gname);\n      })\n      .attr(\"d\", arc);\n\n    g.append(\"svg:text\")\n      .each(function (d) { d.angle = (d.startAngle + d.endAngle) / 2; })\n      .attr(\"dy\", \".35em\")\n      .style(\"font-family\", \"helvetica, arial, sans-serif\")\n      .style(\"font-size\", \"9px\")\n      .style(\"fill\", \"white\")\n      .attr(\"text-anchor\", function (d) { return d.angle > Math.PI ? \"end\" : null; })\n      .attr(\"transform\", function (d) {\n        return \"rotate(\" + (d.angle * 180 / Math.PI - 90) + \")\" +\n          \"translate(\" + (r0 + 26) + \")\" + (d.angle > Math.PI ? \"rotate(180)\" : \"\");\n      })\n      .text(function (d) { return rdr(d).gname; });\n\n    var chordPaths = svg.selectAll(\"path.chord\")\n      .data(chord.chords())\n      .enter().append(\"svg:path\")\n      .attr(\"class\", \"chord\")\n      .style(\"stroke\", function (d) {\n        return d3.rgb(fill(rdr(d).sname)).darker();\n      })\n      .style(\"fill\", function (d) {\n        return fill(rdr(d).sname);\n      })\n      .attr(\"d\", d3.svg.chord().radius(r0))\n      .on(\"mouseover\", function (d) {\n        d3.select(\".grafana-d3-chord-diagram-tooltip\")\n          .style(\"visibility\", \"visible\")\n          .html(chordTip(rdr(d)))\n          .style(\"top\", function () {\n            return (event.pageY - 170) + \"px\";\n          })\n          .style(\"left\", function () {\n            return (event.pageX - 100) + \"px\";\n          });\n      })\n      .on(\"mouseout\", function (d) {\n        d3.select(\".grafana-d3-chord-diagram-tooltip\").style(\"visibility\", \"hidden\");\n      });\n\n    function chordTip(d) {\n      console.log(\"Display tooltip\");\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\");\n      return \"Chord Info:<br/>\" + \n        \"Leaving \" + d.sname + \" to \" + d.tname + \": \" + d.svalue + \"<br/>\" +\n        p(d.svalue / d.stotal) + \" of \" + d.sname + \"'s leaving  (\" + d.stotal + \")<br/>\" +\n        p(d.svalue / d.mtotal) + \" of total transitions (\" + d.mtotal + \")<br/>\" + \n        \"<br/>\" +\n        \"Entering \" +d.tname + \" from \" + d.sname + \": \" + d.tvalue + \"<br/>\" +\n        p(d.tvalue / d.ttotal) + \" of \" + d.tname + \"'s entering (\" + d.ttotal + \")<br/>\" +\n        p(d.tvalue / d.mtotal) + \" of total transitions (\" + d.mtotal + \")\";\n    }\n\n    function groupTip(d) {\n      var p = d3.format(\".1%\"), q = d3.format(\",.2f\");\n      return \"Group Info:<br/>\" + \n        d.gname + \" : \" + d.gvalue + \" transitions <br/>\" +\n        p(d.gvalue / d.mtotal) + \" of total transitions (\" + d.mtotal + \")\";\n    }\n\n    function mouseover(d, i) {\n      d3.select(\".grafana-d3-chord-diagram-tooltip\")\n        .style(\"visibility\", \"visible\")\n        .html(groupTip(rdr(d)))\n        .style(\"top\", function () {\n          return (event.pageY - 80) + \"px\";\n        })\n        .style(\"left\", function () {\n          return (event.pageX - 130) + \"px\";\n        });\n\n      chordPaths.classed(\"fade\", function (p) {\n        return p.source.index != i && p.target.index != i;\n      });\n    }\n  }\n\n  function build() {\n    var mpr = chordMpr(data);\n\n    mpr\n      .addValuesToMap(\"leavingPage\")\n      .setFilter(function (row, a, b) {\n        return (row.leavingPage === a.name && row.enteringPage === b.name);\n      })\n      .setAccessor(function (recs, a, b) {\n        if (!recs[0]) return 0;\n        return +recs[0].count;\n      });\n    return drawChords(mpr.getMatrix(), mpr.getMap());\n  }\n\n  return build();\n} "]}